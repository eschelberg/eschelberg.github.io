{% assign url_parts = page.url | split: '/' %}
{% assign url_parts_size = url_parts | size %}
{% assign rm = url_parts | last %}
{% assign base_url = page.url | replace: rm %}

{% if url_parts_size > 2%}
{% assign pages = site.pages | reverse %}
<ul class="submenu">
{% for node in pages %}
  {% if node.url contains base_url %}
    {% assign node_url_parts = node.url | split: '/' %}
    {% assign node_url_parts_size = node_url_parts | size %}
    {% assign filename = node_url_parts | last %}
    {% if url_parts_size == node_url_parts_size and filename != 'index.html'%}
        {% include submenu-item.html %}
    {% elsif url_parts_size < node_url_parts_size and filename == 'index.html'%}
        {% include submenu-item.html %}
    {% endif %}
  {% endif %}
{% endfor %}
</ul>
{% endif %}
